Frontend={init:function(){Frontend.hideMealsIfNotLoggedIn(),$(".proceed_anonymous").on("click",Frontend.showAnonymousDetailsForm),$(".meal button").on("click",Frontend.processRegistration),$(".meal.deadline_passed button").off("click"),$(".meal.deadline_passed button.unregistered").on("click",Frontend.tooLate),$(".meal.deadline_passed button.registered").on("click",Frontend.tooLate),$("#set_profile_handicap").on("click",Frontend.updateHandicap)},tooLate:function(e){e.preventDefault(),App.showNotification("Je kunt je niet meer aanmelden of afmelden voor deze maaltijd","Deadline verstreken","error")},hideMealsIfNotLoggedIn:function(){$(".user.noone").length>0&&$(".meal").hide()},showAnonymousDetailsForm:function(e){e.preventDefault(),$(".anonymous .method").hide(200),$(".anonymous form").show(200),$(".meal").show(200)},processRegistration:function(e){e.preventDefault();var n=$(this);1==$(".user.someone").size()?n.hasClass("unregistered")?Frontend.register(n):Frontend.deregister(n):n.hasClass("unregistered")&&Frontend.registerNonUser(n)},register:function(e){Frontend.setButtonState(e,"busy",!1),$.ajax({type:"POST",url:"/aanmelden",contentType:"application/json",dataType:"json",data:JSON.stringify({meal_id:e.data("id")}),success:function(){Frontend.setButtonState(e,"registered",!0);var n=e.parents(".meal")[0],t=$(".user .photo").clone().addClass("me");t.css("display","none"),$(".registrations",n).append(t),t.fadeIn(600)},error:function(n){Frontend.setButtonState(e,"unregistered",!0),App.fatalError(n)}})},deregister:function(e){Frontend.setButtonState(e,"busy",!1),$.ajax({type:"POST",url:"/afmelden",contentType:"application/json",dataType:"json",data:JSON.stringify({meal_id:e.data("id")}),success:function(){Frontend.setButtonState(e,"unregistered",!0);var n=e.parents(".meal")[0];$(".registrations .me",n).fadeOut(600,function(){$(this).remove()})},error:function(n){Frontend.setButtonState(e,"registered",!0),App.fatalError(n)}})},registerNonUser:function(e){return Frontend.setButtonState(e,"busy",!1),""===$("#name").val()||""===$("#email").val()?(App.showNotification("Je moet je naam en e-mailadres invullen"),void Frontend.setButtonState(e,"unregistered",!0)):void $.ajax({type:"POST",url:"/aanmelden",contentType:"application/json",dataType:"json",data:JSON.stringify({name:$("#name").val(),email:$("#email").val(),handicap:$("#handicap").val(),meal_id:e.data("id")}),success:function(){Frontend.setButtonState(e,"registered",!1),App.showNotification("Je moet je aanmelding nog bevestigen. We hebben je hiervoor een e-mail gestuurd. Volg de link in de e-mail om je aanmelding definitief te maken.","Bevestiging nodig","warning")},error:function(n){App.fatalError(n),Frontend.setButtonState(e,"unregistered",!0)}})},setButtonState:function(e,n,t){switch(e.removeClass(),e.addClass(n),t||e.addClass("unusable"),n){case"unregistered":e.html("nom!");break;case"busy":e.html('nom! <img src="images/spinner.gif" height="16" width="16" alt="">');break;case"registered":e.html("&#10004;")}},updateHandicap:function(e){e.preventDefault();var n=$("#handicap").attr("data-handicap");swal({title:"Dieetwensen instellen",text:"Specificeer je dieetwensen zo exact en duidelijk mogelijk",type:"input",showCancelButton:!0,closeOnConfirm:!0,inputValue:n},function(e){e!==!1&&e!==n&&$.ajax({type:"POST",url:"/handicap",contentType:"application/json",dataType:"application/json",data:JSON.stringify({handicap:e}),success:function(){$("#handicap").data("handicap",e),""===e?$("#handicap").html("Geen dieet ingesteld").addClass("no_diet"):$("#handicap").html("&ldquo;"+e+"&rdquo;").removeClass("no_diet")},error:App.fatalError})})}},$(document).on("ready",Frontend.init);